Взято с [SqlAcademy](https://sql-academy.org/ru/guide/view), [sql-ex](https://sql-ex.ru/blogs/?/Chto_takoe_materializovannoe_predstavlenie,_i_zachem_ego_ispolzovat.html).
# Представление
**Представление (`VIEW`)** — объект базы данных, являющийся результатом выполнения запроса к базе данных, определённого с помощью оператора `SELECT`, в момент обращения к представлению.

Представления иногда называют «виртуальными таблицами». Это связано с тем, что представление для пользователя выглядит как таблица, но фактически не хранит данных, а извлекает их из других таблиц в момент обращения.

**Если данные в основной таблице меняются, пользователь получает актуальные данные при обращении к представлению, использующему эту таблицу.** При этом представления не кэшируют результаты выборки из таблицы в процессе работы.
```mysql
CREATE [OR REPLACE]
VIEW имя_представления [(имена_полей_представления)]
AS select_выражение
```

`OR REPLACE` — при использовании этого опционального параметра в случае, если представление с таким именем уже существует, старое представление будет удалено, а новое создано. В противном случае, при попытке создать представление с существующим именем, возникнет ошибка.
## Пример создания представления
В качестве простого примера предположим, что вы хотите частично скрыть адреса электронной почты в таблице пользователей (`Users`).
![sql_view](/pictures/sql_view.png)

Это может быть полезно, например, если политика вашей компании не позволяет всем использовать конфиденциальную информацию о пользователях. Поэтому вместо того, чтобы разрешить прямой доступ к таблице пользователей (`Users`), вы определяете представление с именем `ViewUsers` и требуете, чтобы все использовали его для доступа к данным о пользователях.

Вот пример определения этого представления:
```mysql
CREATE VIEW ViewUsers AS
    SELECT id,
           name,
           CONCAT(SUBSTR(email, 1, 2), '****', SUBSTR(email, -4)) AS email
	FROM Users;
```

Представление в SQL-запросе выглядит и используется как обычная таблица:
```sql
SELECT * FROM ViewUsers;
```

|id|name|email|
|---|---|---|
|1|Bruce Willis|ba****.com|
|2|George Clooney|te****.com|
|3|Kevin Costner|me****.com|
|4|Donald Sutherland|ra****.net|
|5|Jennifer Lopez|ba****.com|

Если вы хотите узнать, какие столбцы доступны в представлении, вы можете использовать оператор **`DESCRIBE`**:
```mysql
DESCRIBE ViewUsers;
```

| Field | Type        | Null | Key | Default | Extra |
| ----- | ----------- | ---- | --- | ------- | ----- |
| id    | int         | NO   |     | NULL    |       |
| name  | varchar(32) | NO   |     | NULL    |       |
| email | varchar(38) | YES  |     | NULL    |       |
## Преимущества представления
### Упрощение сложных запросов
Представления используются для упрощения сложных запросов и создания абстракции между пользователем и базой данных. Они могут скрывать сложность структуры данных и предоставлять упрощённый интерфейс для доступа к данным.
### Улучшение производительности
Создание представлений, которые инкапсулируют сложные запросы, может помочь оптимизировать выполнение этих запросов. Это может привести к более быстрому выполнению запросов и улучшению общей производительности базы данных.
### Обеспечение безопасности
Представления могут использоваться для обеспечения безопасности конфиденциальных данных. Создание представлений, которые ограничивают доступ к определённым столбцам или строкам данных, позволяет администраторам ограничить доступ к чувствительной информации. Это помогает гарантировать, что только авторизованные пользователи имеют доступ к конфиденциальным данным.
# Материализованное представление
**Материализованное представление** упрощает сложные данные путём сохранения результатов запросов - Вам не придётся создавать новый запрос всякий раз, когда вам потребуется доступ к соответствующей информации.

Основное, что выделяет материализованное представление, это **копия данных запроса, который не выполняется в реальном времени**. Она занимает немного больше места, но зато и данные извлекаются очень быстро. Вы можете настроить материализованные представления на получение обновленных данных по расписанию с тем, чтобы обновлённая информация не осталась незамеченной.
![sql_materialized_view1](/pictures/sql_materialized_view1.png)

При использовании в сочетании с другими инструментами разработки материализованное представление может создать более безопасную среду для вашей базы данных.
## Сравнение с обычными представлениями
Представления как и материализованные представления могут быть очень полезны для упрощения и оптимизации данных. Вы можете соединить данные из множества разных таблиц и скомпилировать информацию в одну простую таблицу.

Чтобы лучше понять преимущества, которые несет материализованное представление, сравним их с обычными представлениями.
![sql_materialized_view2](/pictures/sql_materialized_view2.png)

**Представление** - это виртуальная таблица, которая собирает данные, которые вы ранее собирали из любого другого соответствующего запроса. Всякий раз, когда вы обращаетесь к представлению, оно **рекомпилирует данные для предоставления актуальной информации в соответствии с надлежащим запросом**.

**Вы можете вносить изменения в представление или в базовые таблицы, и данные будут обновляться автоматически в обоих местах.** Таким образом, если вы вносите изменения в представление, они будут проникать в данные базовых таблиц. Изменение в базовых таблицах автоматически проникает в представление. По этой причине может потребоваться некоторое время для обновления обычного представления.  

**Преимущество обычного представления состоит в том, что оно не занимает много места. Но оно проигрывает в скорости и производительности.**

**Материализованное представление** значительно более эффективно при выполнении запросов. **Данные физически сохраняются в определённый момент времени.** Вам не потребуется всякий раз повторно считывать все данные, связанные с запросом.  

**Недостатком является то, что не гарантируется, что вы видите самые свежие данные.** Чтобы снизить риск получения устаревших данных, вы можете обновлять их вручную или установить обновление по расписанию, или же посредством триггеров.
## Когда использовать материализованные представления
Когда вы понимаете, что делает материализованное представление, может возникнуть вопрос, стоят ли несколько секунд дополнительного места для сохранения копии данных.  
  
Стоит сказать об эффективности стоимости. Всякий запрос к базе данных имеет стоимость. Приложения всё более интенсивно используют ресурсы. Так каждый шаг выполнения запроса (разбор, валидация, планирование, оптимизация) оценивается временем ЦП, использованием памяти и стоимости.  
  
**Материализованные представления существенно снижают стоимость для разработчиков.** Результаты, полученные в материализованном представлении сохраняются в памяти. Они обновляются только по мере необходимости, а не на постоянной основе. Тем самым вы улучшаете производительность предварительным вычислением большинства дорогих операций. Кроме того, при их использовании в запросах к большим базам данных может значительно вырасти скорость.  
  
К сожалению, использование материализованных представлений подходит не во всех ситуациях. **Не всякая база данных поддерживает материализованные представления.**  
  
Есть и другие проблемы. **Материализованные представления могут использоваться только на чтение.** Это означает, что вы не можете обновлять таблицы из материализованного представления так, как вы это делаете с помощью обычного представления. Кроме того, хотя материализованные представления довольно безопасны, всё же имеется некоторый риск, поскольку не все функции безопасности присутствуют. Например, **вы не можете создать ключи безопасности или ограничения на материализованном представлении**.