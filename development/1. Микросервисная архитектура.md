Взято с Atlassian ([1](https://www.atlassian.com/ru/microservices)) ([2](https://www.atlassian.com/ru/microservices/microservices-architecture)), [Skillbox](https://skillbox.ru/media/code/o-mikroservisnoy-arkhitekture-prostymi-slovami/).
# Микросервисная архитектура
**Микросервисная архитектура** ― это подход к разработке программного обеспечения, при котором систему разделяют на небольшие независимые сервисы. Каждый выполняет определённую функцию и взаимодействует с другими сервисами через API.
## Микросервисы
**Микросервис** — это функция, отвечающая за один элемент логики. Несколько микросервисов лежат в основе распределённых приложений, таких как [Jira Software](https://www.atlassian.com/ru/software/jira).

Существует три типа микросервисов.
1. **Предметно-ориентированные микросервисы** характеризуются слабой связанностью и схожими функциональными возможностями.
2. **Интеграционные микросервисы** обеспечивают взаимодействие между несвязанными приложениями.
3. **Микросервисы элементарных операций** выполняют отдельные функции.

**Микросервисы взаимодействуют друг с другом с помощью интерфейсов программирования приложений (API).** Разработчики, отвечающие за отдельные службы, могут изучать внутреннюю работу других микросервисов, что является ещё одним преимуществом перед монолитной архитектурой.
## Ключевые принципы микросервисов
У архитектуры на основе микросервисов есть ряд отличительных особенностей. **Разработчики могут независимо друг от друга создавать и развёртывать службы, используя для этого наиболее подходящие языки и технологии.**

Связь между микросервисами основана на API, за счёт чего **можно получать доступ к данным из различных источников без риска их изменения**. Отдельные службы масштабируются в зависимости от спроса, что способствует экономии и высокой доступности.

Эти качества делают распределённые приложения на основе микросервисов гибкими и простыми в обслуживании.
## Из чего состоит микросервисная архитектура
### Микросервис
**Микросервис** ― это небольшой автономный компонент системы. Его можно разработать и развернуть независимо от других компонентов. Каждый модуль отвечает за конкретную функцию. Система может быть распределённой. Это значит, что микросервисы могут работать на разных серверах и связываться друг с другом.
### API
**API** ― это набор правил и команд, который позволяет разным программам взаимодействовать друг с другом.

В микросервисной архитектуре API — набор универсальных «ручек», доступ к которым можно предоставить каждому. Если надо, чтобы один из микросервисов что-то сделал, то можно просто «дёрнуть ручку» и получить ответ. При этом не надо знать, как сервис будет выполнять задачу.

Работу API можно рассмотреть на примере автомобиля. Под капотом у него находится двигатель, система управления климатом, электроника и множество датчиков. В салоне водитель видит только кнопки и рычаги. Если он захочет набрать скорость, то просто сильнее нажмёт на педаль газа. Ему не надо знать, как в этот момент будет подаваться топливо и охлаждаться двигатель. В этом случае элементы управления в салоне авто — ручки API.
### API-шлюзы (API Gateways)
Представим, что вы хотите попасть в здание, но, чтобы войти, нужно пройти через охранника. Он проверяет вашу личность, разрешает войти и подсказывает, как сориентироваться внутри здания. В мире компьютерных программ эти функции выполняют **API-шлюзы (API Gateways)**. Они — проводники между разными частями сервиса. Когда одна часть программы хочет отправить запрос другой, она делает это через шлюз.

API Gateway проверяет, имеет ли программа право делать то, что она запрашивает. Это как проверка вашего паспорта охранником. Если всё в порядке, он направит программу туда, куда нужно, ― как охранник, направляющий вас в нужное место.

Шлюз может сохранять некоторые ответы, чтобы не запрашивать их каждый раз заново. Это как если бы охранник помнил, что вы уже были тут раньше и сразу вас пропускал.

Так что API Gateway ― это такой контрольно-пропускной пункт для взаимодействия разных частей программы между собой. Он проверяет уровни доступа и направляет запрос в нужную сторону.
### Базы данных
**База данных** ― это виртуальное хранилище информации. Вместо того чтобы держать данные в отдельных файлах или таблицах, их помещают в единую базу. Так намного быстрее и удобнее искать информацию.

Микросервисы используют базы данных для хранения информации. При этом у каждого сервиса она может быть своя. Например, в интернет-магазине один микросервис отвечает за то, чтобы заносить данные новых пользователей в базу, а другой ― подгружает данные о товарах из своей базы по мере обновления страницы.
### Мониторинг
**Системы мониторинга** анализируют состояние каждого микросервиса для поддержания работоспособности всего приложения. Каждый микросервис записывает логи — файлы, которые содержат информацию о его работе. Это могут быть сообщения о событиях, ошибках, запросах и других важных моментах.

С помощью этого можно автоматически собирать метрики для оценки производительности микросервисов. Все полученные данные сохраняются, чтобы потом можно было проанализировать аномалии и тренды.
### Конфигурация
**Конфигурация в микросервисах** — централизованный способ изменения параметров, которые влияют на работу всей системы. Поскольку микросервисы разрабатывают независимо друг от друга, важно иметь возможность менять конфигурацию не только отдельных сервисов, но и сразу всех компонентов без перезапуска.

Представьте себе кофейню с разными напитками в меню: эспрессо, латте и американо. Для каждого вида кофе есть рецепт, в котором отмечено количество зёрен, их сорт, температура воды и время заваривания. Рецепты ― это ваша конфигурация.

Если вы решите изменить порядок приготовления эспрессо, то лучше сразу обновить рецепт в базе данных заведения. Иначе придётся бегать по всему кафе и рассказывать каждому бариста о том, как теперь следует заваривать эспрессо.
### Контейнеризация
Для развёртывания и масштабирования микросервисов использую **контейнеры и системы оркестрации**. Чаще всего разработчики выбирают для этого популярные Docker и Kubernetes.

С помощью контейнеров можно упаковать микросервисы со всем необходимым для переноса на сервер. Если надо будет переехать, то разработчикам не придётся собирать всё снова. Это и делает микросервисы переносимыми. Ещё контейнеры отвечают за изоляцию, предотвращая влияние сервисов друг на друга.
## Различия между микросервисной архитектурой и монолитной
![microservices1](/pictures/microservices1.png)
### Монолитная
**Монолитная архитектура** ― традиционный подход к разработке программного обеспечения. **Приложение представляет собой модуль, в котором объединены все компоненты.** Управление интерфейсом, бизнес-логикой и базой данных осуществляется в одном месте.

Монолитная архитектура кажется более простой и понятной. Но, когда продукт разрастается, поддерживать такую архитектуру становится сложно.

**Преимущества**:
- **Простота разработки.** Все компоненты приложения находятся в одном месте, что делает процесс разработки простым и прозрачным.
- **Простота развёртывания.** Развёртывание монолитного приложения проще, так как для этого не требуется управления большим количеством микросервисов.
- **Меньшие затраты на инфраструктуру.** Монолиты часто требуют меньше инфраструктуры для развёртывания и поддержки, что помогает сократить затраты на разработку.
- **Уменьшенная зависимость от сети.** Поскольку все части приложения работают в пределах одного процесса, нет необходимости в постоянном взаимодействии по сети.

**Недостатки**:
- **Сложность масштабирования.** Монолиты могут столкнуться с трудностями в масштабировании, особенно если определённые части приложения требуют больше ресурсов.
- **Взаимозависимость компонентов.** Если одна часть монолита требует изменений, это может повлиять на всю систему, что затрудняет внесение изменений.
- **Сложность поддержки.** Большие проекты тяжело поддерживать и понимать, как работают все их компоненты.
- **Ограниченная гибкость.** Изменения в одной части монолита могут затронуть другие, что может сделать систему менее гибкой и податливой к изменениям.
- **Ограниченность стека.** Монолиты обычно используют единый стек технологий, что ограничивает возможности использования различных технологий для разных компонентов.
### Микросервисная
Микросервисная архитектура имеет ряд преимуществ перед монолитной архитектурой.

**Преимущества**:
- **Гибкость**. Микросервисы позволяют разрабатывать, изменять и масштабировать отдельные части приложения независимо от других. Это делает систему более гибкой.
- **Масштабируемость**. Каждый микросервис можно масштабировать отдельно от всей системы. Сложность проекта растёт вместе с увеличением нагрузки.
- **Изоляция ошибок**. Проблемы в одном микросервисе редко влияют на остальные, а значит, искать и устранять ошибки становится проще.
- **Свобода стека.** Для каждого микросервиса можно выбрать свой стек технологий и язык программирования. Это даёт больше свободы разработчикам.

**Недостатки**:
- **Сложность управления.** Чем больше микросервисов в проекте, тем сложнее ими управлять. Для этого нужны дополнительные инструменты и специалисты.
- **Зависимость от сети.** Микросервисы общаются друг с другом по сети, это может вызывать задержки и проблемы с производительностью.
- **Затраты на развёртывание и инфраструктуру.** Развёртывание и поддержка инфраструктуры для микросервисов обходится дороже.
## Пример микросервисной архитектуры
Рассмотрим в качестве примера гипотетический проект разработки ПО для электронной коммерции. На следующей схеме показан сайт электронной коммерции с веб-приложением и мобильным приложением. Они взаимодействуют с несколькими микросервисами, каждый из которых предоставляет определённые возможности в своей области.
![microservices2](/pictures/microservices2.png)

Современные веб-приложения запускаются в браузерах и нередко предоставляются через **сеть распространения контента (CDN)**. Сеть CDN может доставлять веб-приложения на серверы по всему миру, чтобы их можно было быстро загрузить с помощью веб-браузеров. Сети CDN часто используют для предоставления мультимедийных ресурсов, таких как изображения, аудиозаписи и видеофайлы. Например, в этой системе через CDN предоставляются видеоролики и изображения товаров для продажи.

На схеме изображены следующие микросервисы:
- **Сервис аккаунтов**. Сервис аккаунтов предоставляет информацию об аккаунте клиента, например адрес и платёжную информацию.
- **Сервис запасов**. Предоставляет актуальную информацию о запасах товаров, которые может купить клиент.
- **Сервис корзины для покупок**. С помощью этого сервиса клиент выбирает из запасов те товары, которые он хочет приобрести.
- **Платёжный сервис**. Клиенты оплачивают товары в корзине.
- **Сервис доставки**. Отвечает за планирование упаковки и доставки приобретённых товаров.

Приложения взаимодействуют с микросервисами через API-интерфейсы REST, которые публикует каждый микросервис. Приложения обращаются к API-интерфейсам микросервисов через API-шлюз, который также позволяет заменять одни микросервисы другими с тем же API.

Каждый микросервис состоит из сервиса и базы данных. Сервисы работают с API-интерфейсами REST, реализуют бизнес-логику и сохраняют информацию в базе данных. Ресурсы микросервисов, такие как базы данных и очереди, изолируются в соответствии с соглашением о [12-факторных приложениях](https://12factor.net/).