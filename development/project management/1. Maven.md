Взято с [Gitverse](https://gitverse.ru/blog/articles/development/286-osnovy-raboty-na-frejmvorke-apache-maven-v-java), [KursHub](https://kurshub.ru/journal/blog/maven-kak-uskorit-razrabotku-i-izbezhat-oshibok/), [forEach](https://for-each.dev/lessons/b/-maven).
# Apache Maven
Создание программного проекта обычно состоит из таких задач, как загрузка зависимостей, размещение дополнительных jar-файлов в пути к классам, компиляция исходного кода в двоичный код, выполнение тестов, упаковка скомпилированного кода в развёртываемые артефакты, такие как файлы JAR, WAR и ZIP, и развёртывание этих артефактов.

**Apache Maven** автоматизирует эти задачи, сводя к минимуму риск ошибок людей при сборке программного обеспечения вручную и отделяя работу по компиляции и упаковке нашего кода от работы по его построению.

Инструмент используется для: 
- быстрой настройки проекта и работы с его структурой;
- упрощения процесса сборки;
- управления зависимостями и работы с автоматическим обновлением;
- работы с несколькими проектами одновременно;
- динамической загрузки необходимых плагинов Java и библиотек из репозитория;
- получения информации о качестве проекта, исследования списков зависимостей, источников с перекрестными ссылками и отчётом о модульном тестировании.
## POM
Конфигурация проекта Maven выполняется с помощью **объектной модели проекта (Project Object Model, POM)**, представленной файлом *pom.xml*. POM описывает проект, управляет зависимостями и настраивает плагины для сборки программного обеспечения.

POM также определяет отношения между модулями многомодульных проектов. Давайте посмотрим на базовую структуру типичного файла POM:
```xml
<project>
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.foreach</groupId>
    <artifactId>foreach</artifactId>
    <packaging>jar</packaging>
    <version>1.0-SNAPSHOT</version>
    <name>com.foreach</name>
    <url>http://maven.apache.org</url>
    <dependencies>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.8.2</version>
            <scope>test</scope>
        </dependency>
    </dependencies>
    <build>
        <plugins>
            <plugin>
            //...
            </plugin>
        </plugins>
    </build>
</project>
```
### Идентификаторы проекта
Maven использует набор **идентификаторов**, также называемых координатами, для уникальной идентификации проекта и указания того, как должен быть упакован артефакт проекта:
- `groupId` — уникальное базовое имя компании или группы, создавшей проект;
- `artiftId` — уникальное имя проекта;
- `version` – версия проекта;
- `packaging` — метод упаковки (например, `WAR` / `JAR` / `ZIP`).

Первые три из них (`groupId:artifactId:version`) объединяются для формирования уникального идентификатора и представляют собой механизм, с помощью которого вы указываете, какие версии внешних библиотек (например, JAR) будут использоваться в вашем проекте.
### Зависимости
Эти внешние библиотеки, которые использует проект, называются **зависимостями**. Функция управления зависимостями в Maven обеспечивает автоматическую загрузку этих библиотек из центрального репозитория, поэтому вам не нужно хранить их локально.

Это ключевая функция Maven, обеспечивающая следующие преимущества:
- использует меньше места для хранения за счёт значительного сокращения количества загрузок из удаленных репозиториев;
- ускоряет проверку проекта;
- предоставляет эффективную платформу для обмена двоичными артефактами внутри вашей организации и за её пределами без необходимости каждый раз создавать артефакты из исходного кода.

Чтобы объявить зависимость от внешней библиотеки, вам необходимо указать `groupId:artifactId:version` библиотеки. Давайте рассмотрим пример:
```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-core</artifactId>
    <version>5.3.16</version>
</dependency>
```

Когда Maven обработает зависимости, он загрузит библиотеку Spring Core в ваш локальный репозиторий Maven.
### Репозитории
**Репозиторий** можно назвать каталогом на компьютере. Здесь хранятся файлы проекта, подключаемые модули или другие материалы.

Репозиторий может быть трёх типов:
- **локальный**;
- **центральный**;
- **удалённый**.

Когда требуется выполнить поиск зависимостей, сначала выполняется поиск в локальном хранилище. Затем в центральном хранилище. А потом в удалённом хранилище.

Если зависимости не обнаружены ни в одном из трех хранилищ, пользователь получает сообщение об ошибке. Тогда процесс завершается.
#### Локальный репозиторий
Это каталог на компьютере, в котором хранятся все компоненты проекта. Когда сборка завершена, фреймворк автоматически загружает все файлы зависимостей в локальный репозиторий.

Локальный репозиторий по умолчанию — каталог *user_home/m2*. Путь по умолчанию можно изменить в *settings.xml*.
#### Центральный репозиторий
Если зависимости не найдены в локальном репозитории, фреймворк выполняет поиск в центральном репозитории. Затем он загружает зависимости в локальный. Как и в случае с локальным хранилищем, путь к центральному хранилищу может быть изменен в *setting.xml*.
#### Удалённый репозиторий
Он похож на центральный репозиторий. Когда фреймворк хочет загрузить зависимость, она отправляется в удалённый репозиторий. Он находится на веб-сервере и широко используется для размещения внутренних проектов компании.
### Свойства
**Пользовательские свойства** могут помочь упростить чтение и обслуживание файла *pom.xml*. В классическом случае вы должны использовать настраиваемые свойства для определения версий зависимостей вашего проекта.

**Свойства Maven являются заполнителями значений и доступны в любом месте *pom.xml* с помощью нотации `${name}`** , где `name` — это свойство.

Давайте посмотрим пример:
```xml
<properties>
    <spring.version>5.3.16</spring.version>
</properties>

<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-core</artifactId>
        <version>${spring.version}</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>${spring.version}</version>
    </dependency>
</dependencies>
```

Теперь, если вы хотите обновить Spring до более новой версии, вам нужно только изменить значение внутри тега свойства `<spring.version>`, и все зависимости, использующие это свойство в своих тегах `<version>`, будут обновлены.
### Сборка
Раздел **`build`** также является очень важным разделом Maven POM. Он предоставляет информацию о `goal` Maven по умолчанию, каталоге для скомпилированного проекта и окончательном имени приложения. Раздел `build` по умолчанию выглядит так:
```xml
<build>
    <defaultGoal>install</defaultGoal>
    <directory>${basedir}/target</directory>
    <finalName>${artifactId}-${version}</finalName>
    <filters>
      <filter>filters/filter1.properties</filter>
    </filters>
    //...
</build>
```

Выходная папка по умолчанию для скомпилированных артефактов называется *target*, а окончательное имя упакованного артефакта состоит из `atrefactId` и `version`, но вы можете изменить его в любое время.
### Использование профилей
Ещё одна важная особенность Maven — поддержка **профилей**. Профиль в основном представляет собой набор значений конфигурации. Используя профили, вы можете настроить сборку для различных сред, таких как производство/тестирование/разработка:
```xml
<profiles>
    <profile>
        <id>production</id>
        <build>
            <plugins>
                <plugin>
                //...
                </plugin>
            </plugins>
        </build>
    </profile>
    <profile>
        <id>development</id>
        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>
        <build>
            <plugins>
                <plugin>
                //...
                </plugin>
            </plugins>
        </build>
     </profile>
 </profiles>
```

Как видно из приведённого выше примера, профиль по умолчанию — `development` . Если вы хотите запустить `production` профиль, вы можете использовать следующую команду Maven:
```
mvn clean install -Pproduction
```
## Жизненный цикл сборки
Maven основан на концепции жизненного цикла сборки. Он определяет порядок выполнения задач. Жизненный цикл по умолчанию состоит из 7 основных этапов:
- **validate**: проверяет проект Maven, чтобы убедиться, что всё правильно и вся необходимая информация доступна;
- **compile**: компилирует исходные Java-классы проекта;
- **test**: запускает тестовые примеры проекта;
- **package**: собирает проект Maven и упаковывает его в JAR, WAR и т.д.;
- **verify**: создаёт проект, запускает все тестовые случаи и выполняет любые проверки результатов интеграционных тестов, чтобы убедиться, что критерии качества соблюдены;
- **install**: создаёт проект Maven и устанавливает файлы проекта (JAR, WAR, *pom.xml* и т. д.) в локальное хранилище;
- **deploy**: развёртывает артефакт в удалённом хранилище.